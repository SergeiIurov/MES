<div class="row">
  <div class="col-4">
    <fieldset>
      <legend>Список пользователей</legend>
      <p-button label="Добавить пользователя" (onClick)="newUserDialogVisible=true"></p-button>
      <table class="table table-active">
        <thead>
        <tr>
          <th>Пользователь</th>
          <th>Роль</th>
        </tr>
        </thead>
        <tbody>
          @for (login of logins; track login.name) {

            <tr>
              <td>{{ login.name }}
                <p-button size="small" title="Удалить пользователя"  [disabled]="auth.name === login.name" icon="pi pi-minus" variant="text" severity="danger"
                          (click)="deleteUser(login)"></p-button>
              </td>
              <td>{{ Roles[login.role] }}
                <p-button size="small" [disabled]="auth.name === login.name" title="Сменить роль пользователя" icon="pi pi-pencil" variant="text"
                          severity="info"
                          (click)="openChangeRoleDialog(login)"></p-button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </fieldset>
  </div>
</div>
<!--Дилог для создания нового участка    -->
<p-dialog header="Создание нового пользователя" [modal]="true" [(visible)]="newUserDialogVisible"
          [style]="{ width: '35rem' }">
  <div class="flex items-center gap-4 mb-4">
    <label for="login" class="font-semibold w-24">Логин:</label>
    <input [pAutoFocus]="true" pInputText #loginName id="login" class="flex-auto" autocomplete="off"/>
  </div>
  <div class="flex items-center gap-4 mb-4">
    <label for="role" class="font-semibold w-24">Роль:</label>
    <select pInputText #role id="role" class="flex-auto" autocomplete="off">
      @for (key of roles; track key) {
        <option value="{{key}}">{{ Roles[key] }}</option>
      }
    </select>
  </div>
  <div class="flex items-center gap-4 mb-4">
    <label for="password" class="font-semibold w-24">Пароль:</label>
    <input pInputText #password id="password" type="password" class="flex-auto" autocomplete="off"/>
  </div>
  <div class="flex justify-end gap-2">
    <p-button label="Сохранить"
              (click)="addUser({name:loginName.value.trim(),password:password.value.trim(),role:+role.value.trim()})"/>
    <p-button label="Отмена" severity="secondary" (click)="newUserDialogVisible = false"/>
  </div>
</p-dialog>
<p-dialog header="Сменить роль" [modal]="true" [(visible)]="changeRoleDialogVisible"
          [style]="{ width: '35rem' }">
  <div class="flex items-center gap-4 mb-4">
    <label for="login" class="font-semibold w-24">Логин:</label>
    <input [pAutoFocus]="true" pInputText #l disabled="true" [value]="login?.name" readonly id="login" class="flex-auto"
           autocomplete="off"/>
  </div>
  <div class="flex items-center gap-4 mb-4">
    <label for="role" class="font-semibold w-24">Роль:</label>
    <select pInputText #r id="role" class="flex-auto" [value]="login?.role" autocomplete="off">
      @for (key of roles; track key) {
        <option value="{{key}}">{{ Roles[key] }}</option>
      }
    </select>
  </div>
  <div class="flex justify-end gap-2">
    <p-button label="Сохранить"
              (click)="changeRole(l.value.trim(),+r.value.trim())"/>
    <p-button label="Отмена" severity="secondary" (click)="changeRoleDialogVisible = false"/>
  </div>
</p-dialog>
<p-confirm-dialog/>
